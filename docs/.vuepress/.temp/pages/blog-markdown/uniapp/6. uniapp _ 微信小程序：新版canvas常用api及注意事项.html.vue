<template><div><h1 id="uniapp-å¾®ä¿¡å°ç¨‹åº-æ–°ç‰ˆcanvaså¸¸ç”¨apiåŠæ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#uniapp-å¾®ä¿¡å°ç¨‹åº-æ–°ç‰ˆcanvaså¸¸ç”¨apiåŠæ³¨æ„äº‹é¡¹"><span>uniapp + å¾®ä¿¡å°ç¨‹åºï¼šæ–°ç‰ˆcanvaså¸¸ç”¨apiåŠæ³¨æ„äº‹é¡¹</span></a></h1>
<h1 id="å…³äºæ–°æ—§canvasçš„æ¯”è¾ƒæˆ‘ä»¥å‰å†™è¿‡ä¸€ç¯‡åšå®¢-https-www-cnblogs-com-sunshine233-p-17014701-html-è¿™é‡Œå°±ä¸é‡å¤äº†ã€‚" tabindex="-1"><a class="header-anchor" href="#å…³äºæ–°æ—§canvasçš„æ¯”è¾ƒæˆ‘ä»¥å‰å†™è¿‡ä¸€ç¯‡åšå®¢-https-www-cnblogs-com-sunshine233-p-17014701-html-è¿™é‡Œå°±ä¸é‡å¤äº†ã€‚"><span>å…³äºæ–°æ—§canvasçš„æ¯”è¾ƒæˆ‘ä»¥å‰å†™è¿‡ä¸€ç¯‡åšå®¢ ï¼šhttps://www.cnblogs.com/sunshine233/p/17014701.html ï¼Œè¿™é‡Œå°±ä¸é‡å¤äº†ã€‚</span></a></h1>
<p>ä½†åœ¨æ­£æ–‡å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä¸å¾—ä¸å†è¯´ä¸€éå¾®ä¿¡çš„æ–‡æ¡£å†™çš„çœŸåƒåœ¾ã€‚å¾ˆå¤šé—®é¢˜çš„ç­”æ¡ˆéƒ½æ˜¯åœ¨å¾®ä¿¡å¼€å‘è€…ç¤¾åŒºé‡Œæ‰¾åˆ°çš„ã€‚</p>
<h1 id="ä¸€ã€æ–°ç‰ˆcanvas-åŸºç¡€ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€æ–°ç‰ˆcanvas-åŸºç¡€ç”¨æ³•"><span>ä¸€ã€æ–°ç‰ˆcanvas åŸºç¡€ç”¨æ³•ï¼š</span></a></h1>
<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre v-pre><code><span class="line">&lt;template></span>
<span class="line">    &lt;view></span>
<span class="line">        &lt;view class="divider">æ–°ç‰ˆcanvas ğŸ‘‡&lt;/view></span>
<span class="line">        &lt;!-- 1. canvas-id æ¢æˆäº† id --></span>
<span class="line">        &lt;!-- 2. å¢åŠ äº† type="2d" è¡¨ç¤ºæ–°ç‰ˆcanvas --></span>
<span class="line">        &lt;canvas id="myCanvas" type="2d" >&lt;/canvas></span>
<span class="line">    &lt;/view></span>
<span class="line">&lt;/template></span>
<span class="line"></span>
<span class="line">&lt;script></span>
<span class="line">    export default {</span>
<span class="line">        data() {</span>
<span class="line">            return {}</span>
<span class="line">        },</span>
<span class="line">        mounted() {</span>
<span class="line">            this.newCanvas();</span>
<span class="line">        },</span>
<span class="line">        methods: {</span>
<span class="line">            newCanvas() {</span>
<span class="line">                // 3. è·å–canvasèŠ‚ç‚¹çš„æ–¹å¼å˜äº†ï¼Œå¿…é¡»æŒ‰ç…§è¿™ä¸ªæ ¼å¼å†™</span>
<span class="line">                // 3.1 å¦‚æœä¸æ˜¯ç›´æ¥é¡µé¢è€Œæ˜¯å­é¡µé¢ï¼ŒæŠŠ wx æ”¹æˆ thisï¼Œå¦åˆ™è·å–ä¸åˆ° nodeèŠ‚ç‚¹</span>
<span class="line">                // ä¹Ÿå°±æ˜¯ wx.createSelectorQuery()  å…¶å¥¹éƒ¨åˆ†ä¸€æ ·</span>
<span class="line">                wx.createSelectorQuery()</span>
<span class="line">                    .select('#myCanvas')</span>
<span class="line">                    .node(({</span>
<span class="line">                        node: canvas</span>
<span class="line">                    }) => {</span>
<span class="line">                        //4. è·å–æ­£ç¡®å®ä¾‹</span>
<span class="line">                        const ctx = canvas.getContext('2d');</span>
<span class="line">    </span>
<span class="line">                        ctx.fillStyle = "green";</span>
<span class="line">                        ctx.fillRect(0, 0, 50, 50);</span>
<span class="line">                        // 4.1 è®¾ç½®å­—ä½“å¤§å°ï¼ˆä¸¤ä¸ªå‚æ•°å¿…é¡»éƒ½å†™ï¼‰</span>
<span class="line">                        ctx.font = "20px sans-serif";</span>
<span class="line">                        // 4.2 å†™æ–‡å­—</span>
<span class="line">                        ctx.fillText("æˆ‘æ˜¯æ–°ç‰ˆcanvas", 50, 30);</span>
<span class="line">                        // 4.3 æ–°ç‰ˆ canvas ä¸éœ€è¦è°ƒç”¨ draw()</span>
<span class="line">                        // ctx.draw(); </span>
<span class="line">                    }).exec();</span>
<span class="line">            },</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line">&lt;/script></span>
<span class="line"></span>
<span class="line">&lt;style scoped></span>
<span class="line">    .divider {</span>
<span class="line">        margin: 10px 0;</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    canvas {</span>
<span class="line">        background-color: antiquewhite;</span>
<span class="line">    }</span>
<span class="line">&lt;/style></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»£ç ä¸­è·å–å®ä¾‹çš„å†™æ³•å’Œå®˜æ–¹å®ä¾‹æ•ˆæœä¸€æ ·</p>
<p><img src="https://img2024.cnblogs.com/blog/2194212/202502/2194212-20250224152737434-84669005.png" alt="img"></p>
<p>è¿è¡Œç»“æœï¼š</p>
<p><img src="https://img2024.cnblogs.com/blog/2194212/202502/2194212-20250224152459638-878269718.png" alt="img"></p>
<h1 id="äºŒã€æ–°ç‰ˆcanvasç”»å›¾æ¨¡ç³Šå¤±çœŸ" tabindex="-1"><a class="header-anchor" href="#äºŒã€æ–°ç‰ˆcanvasç”»å›¾æ¨¡ç³Šå¤±çœŸ"><span>äºŒã€æ–°ç‰ˆcanvasç”»å›¾æ¨¡ç³Šå¤±çœŸ</span></a></h1>
<p>ä½†canvaså®é™…ä¸Šæœ‰ä¸¤ç§è®¾ç½®å°ºå¯¸çš„æ–¹å¼ï¼š</p>
<ul>
<li>ä¸€ç§æ˜¯é»˜è®¤å°ºå¯¸300*150ï¼ˆæ–‡æ¡£ä¸­å†™å¯ä»¥ç›´æ¥ç”¨ <canvas id="myCanvas" type="2d" width="300" height="300"></canvas> ä¿®æ”¹ï¼Œä½†æˆ‘2025/2/24å°è¯•å¥½åƒä¸èµ·æ•ˆäº†ï¼‰ï¼›</li>
<li>ä¸€ç§æ˜¯åœ¨cssä¸­è®¾ç½® canvas { width: 300px; height: 300px; }</li>
</ul>
<p>è¿™ä¸¤ä¸ªå°ºå¯¸è¢«æˆä¸º<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/ability/canvas.html" target="_blank" rel="noopener noreferrer">æ¸²æŸ“å®½é«˜å’Œé€»è¾‘å®½é«˜</a>ã€‚ä½†æˆ‘è§‰å¾—å¾®ä¿¡æ–‡æ¡£å†™çš„ä¼¼ä¹æœ‰ç‚¹é—®é¢˜ä¸”æ¨¡ç³Šä¸æ¸…ã€‚</p>
<p><img src="https://img2024.cnblogs.com/blog/2194212/202502/2194212-20250224154620301-2099265022.png" alt="img"></p>
<p>æŸ¥äº†åˆ«çš„æ–‡æ¡£ + å®è·µï¼Œæˆ‘å‘ç°å¦‚æœåœ¨cssä¸­æ‰‹åŠ¨è®¾ç½®äº†canvasçš„å®½é«˜ï¼Œç”»å›¾å°±ä¼šå‡ºç°æ¨¡ç³Šï¼ˆå› ä¸ºcanvaWidthå’ŒstyleWidthä¸ä¸€è‡´ï¼‰ã€‚</p>
<p>å’Œä¸Šä¸€æ®µä»£ç å·®å¼‚åªå¢åŠ äº†css</p>
<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre v-pre><code><span class="line">&lt;template></span>
<span class="line">    &lt;view></span>
<span class="line">        &lt;view class="divider">æ–°ç‰ˆcanvas ğŸ‘‡&lt;/view></span>
<span class="line">        &lt;!-- 1. canvas-id æ¢æˆäº† id --></span>
<span class="line">        &lt;!-- 2. å¢åŠ äº† type="2d" è¡¨ç¤ºæ–°ç‰ˆcanvas --></span>
<span class="line">        &lt;canvas id="myCanvas" type="2d" >&lt;/canvas></span>
<span class="line">    &lt;/view></span>
<span class="line">&lt;/template></span>
<span class="line"></span>
<span class="line">&lt;script></span>
<span class="line">    export default {</span>
<span class="line">        data() {</span>
<span class="line">            return {}</span>
<span class="line">        },</span>
<span class="line">        mounted() {</span>
<span class="line">            this.newCanvas();</span>
<span class="line">        },</span>
<span class="line">        methods: {</span>
<span class="line">            newCanvas() {</span>
<span class="line">                // 3. è·å–canvasèŠ‚ç‚¹çš„æ–¹å¼å˜äº†ï¼Œå¿…é¡»æŒ‰ç…§è¿™ä¸ªæ ¼å¼å†™</span>
<span class="line">                // 3.1 å¦‚æœä¸æ˜¯ç›´æ¥é¡µé¢è€Œæ˜¯å­é¡µé¢ï¼ŒæŠŠ wx æ”¹æˆ thisï¼Œå¦åˆ™è·å–ä¸åˆ° nodeèŠ‚ç‚¹</span>
<span class="line">                // ä¹Ÿå°±æ˜¯ wx.createSelectorQuery()  å…¶å¥¹éƒ¨åˆ†ä¸€æ ·</span>
<span class="line">                wx.createSelectorQuery()</span>
<span class="line">                    .select('#myCanvas')</span>
<span class="line">                    .node(({</span>
<span class="line">                        node: canvas</span>
<span class="line">                    }) => {</span>
<span class="line">                        //4. è·å–æ­£ç¡®å®ä¾‹</span>
<span class="line">                        const ctx = canvas.getContext('2d');</span>
<span class="line">    </span>
<span class="line">                        ctx.fillStyle = "green";</span>
<span class="line">                        ctx.fillRect(0, 0, 50, 50);</span>
<span class="line">                        // 4.1 è®¾ç½®å­—ä½“å¤§å°ï¼ˆä¸¤ä¸ªå‚æ•°å¿…é¡»éƒ½å†™ï¼‰</span>
<span class="line">                        ctx.font = "20px sans-serif";</span>
<span class="line">                        // 4.2 å†™æ–‡å­—</span>
<span class="line">                        ctx.fillText("æˆ‘æ˜¯æ–°ç‰ˆcanvas", 50, 30);</span>
<span class="line">                    </span>
<span class="line">                        // 4.3 æ–°ç‰ˆ canvas ä¸éœ€è¦è°ƒç”¨ draw()</span>
<span class="line">                        // ctx.draw(); </span>
<span class="line">                    }).exec();</span>
<span class="line">            },</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line">&lt;/script></span>
<span class="line"></span>
<span class="line">&lt;style scoped></span>
<span class="line">    .divider {</span>
<span class="line">        margin: 10px 0;</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    canvas {</span>
<span class="line">        background-color: antiquewhite;</span>
<span class="line">        width: 300px;</span>
<span class="line">        height: 300px;</span>
<span class="line">    }</span>
<span class="line">&lt;/style></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://img2024.cnblogs.com/blog/2194212/202502/2194212-20250224154953413-1564103644.png" alt="img"></p>
<p>æƒ³è§£å†³æ¨¡ç³Šå¤±çœŸçš„é—®é¢˜å°±è¦ä½¿ç”¨ canvas.width = styleWidth<em>dpr; canvas.height = styleHeight</em>dpr; ä¹Ÿå°±æ˜¯é‡æ–°è®¾ç½®canvasçš„å°ºå¯¸ç­‰äºcssä¸­çš„å°ºå¯¸*åƒç´ æ¯”ã€‚</p>
<p>è·å–åƒç´ æ¯”å¾®ä¿¡å·²ç»ç»™å‡ºäº†api ï¼š const dpr = wx.getWindowInfo().pixelRatio;</p>
<p>ç°åœ¨cssä¸­å®½é«˜è®¾ç½®çš„éƒ½æ˜¯300ï¼Œ æ‰€ä»¥è¦è®¾ç½® canvas.width = 300* dpr; canvas.height = 300 * dpr; æœ€åç¼©æ”¾ ctx.scale(dpr, dpr);</p>
<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre v-pre><code><span class="line">&lt;template></span>
<span class="line">    &lt;view></span>
<span class="line">        &lt;view class="divider">æ–°ç‰ˆcanvas ğŸ‘‡&lt;/view></span>
<span class="line">        &lt;!-- 1. canvas-id æ¢æˆäº† id --></span>
<span class="line">        &lt;!-- 2. å¢åŠ äº† type="2d" è¡¨ç¤ºæ–°ç‰ˆcanvas --></span>
<span class="line">        &lt;canvas id="myCanvas" type="2d" >&lt;/canvas></span>
<span class="line">    &lt;/view></span>
<span class="line">&lt;/template></span>
<span class="line"></span>
<span class="line">&lt;script></span>
<span class="line">    export default {</span>
<span class="line">        data() {</span>
<span class="line">            return {}</span>
<span class="line">        },</span>
<span class="line">        mounted() {</span>
<span class="line">            this.newCanvas();</span>
<span class="line">        },</span>
<span class="line">        methods: {</span>
<span class="line">            newCanvas() {</span>
<span class="line">                // 3. è·å–canvasèŠ‚ç‚¹çš„æ–¹å¼å˜äº†ï¼Œå¿…é¡»æŒ‰ç…§è¿™ä¸ªæ ¼å¼å†™</span>
<span class="line">                // 3.1 å¦‚æœä¸æ˜¯ç›´æ¥é¡µé¢è€Œæ˜¯å­é¡µé¢ï¼ŒæŠŠ wx æ”¹æˆ thisï¼Œå¦åˆ™è·å–ä¸åˆ° nodeèŠ‚ç‚¹</span>
<span class="line">                // ä¹Ÿå°±æ˜¯ wx.createSelectorQuery()  å…¶å¥¹éƒ¨åˆ†ä¸€æ ·</span>
<span class="line">                wx.createSelectorQuery()</span>
<span class="line">                    .select('#myCanvas')</span>
<span class="line">                    .node(({</span>
<span class="line">                        node: canvas</span>
<span class="line">                    }) => {</span>
<span class="line">                        //4. è·å–æ­£ç¡®å®ä¾‹</span>
<span class="line">                        const ctx = canvas.getContext('2d');</span>
<span class="line">                     </span>
<span class="line">                        const dpr = wx.getWindowInfo().pixelRatio;</span>
<span class="line">                        console.log("default canvas.width:", canvas.width,</span>
<span class="line">                         " default canvas.height:", canvas.height);</span>
<span class="line">                        console.log("dpr:", dpr);</span>
<span class="line">                        canvas.width = 300* dpr;</span>
<span class="line">                        canvas.height = 300 * dpr;</span>
<span class="line">                        ctx.scale(dpr, dpr);</span>
<span class="line"></span>
<span class="line">                        ctx.fillStyle = "green";</span>
<span class="line">                        ctx.fillRect(0, 0, 50, 50);</span>
<span class="line">                        // 4.1 è®¾ç½®å­—ä½“å¤§å°ï¼ˆä¸¤ä¸ªå‚æ•°å¿…é¡»éƒ½å†™ï¼‰</span>
<span class="line">                        ctx.font = "20px sans-serif";</span>
<span class="line">                        // 4.2 å†™æ–‡å­—</span>
<span class="line">                        ctx.fillText("æˆ‘æ˜¯æ–°ç‰ˆcanvas", 50, 30);</span>
<span class="line"></span>
<span class="line">                        // 4.3 æ–°ç‰ˆ canvas ä¸éœ€è¦è°ƒç”¨ draw()</span>
<span class="line">                        // ctx.draw(); </span>
<span class="line">                    }).exec();</span>
<span class="line">            },</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line">&lt;/script></span>
<span class="line"></span>
<span class="line">&lt;style scoped></span>
<span class="line">    .divider {</span>
<span class="line">        margin: 10px 0;</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    canvas {</span>
<span class="line">        background-color: antiquewhite;</span>
<span class="line">        width: 300px;</span>
<span class="line">        height: 300px;</span>
<span class="line">    }</span>
<span class="line">&lt;/style></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://img2024.cnblogs.com/blog/2194212/202502/2194212-20250224155520075-1435097000.png" alt="img"></p>
<p>å¦‚æœæƒ³ç”¨åŠ¨æ€æ•°æ®å¯ä»¥ç”¨</p>
<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre v-pre><code><span class="line">&lt;template></span>
<span class="line">    &lt;view></span>
<span class="line">        &lt;view class="divider">æ–°ç‰ˆcanvas ğŸ‘‡&lt;/view></span>
<span class="line">        &lt;!-- 1. canvas-id æ¢æˆäº† id --></span>
<span class="line">        &lt;!-- 2. å¢åŠ äº† type="2d" è¡¨ç¤ºæ–°ç‰ˆcanvas --></span>
<span class="line">        &lt;canvas id="myCanvas" type="2d" :style="{width:styleWidth+'px',height:styleHeight+'px'}" >&lt;/canvas></span>
<span class="line">    &lt;/view></span>
<span class="line">&lt;/template></span>
<span class="line"></span>
<span class="line">&lt;script></span>
<span class="line">    export default {</span>
<span class="line">        data() {</span>
<span class="line">            return {</span>
<span class="line">                styleWidth:200,</span>
<span class="line">                styleHeight:100</span>
<span class="line">            }</span>
<span class="line">        },</span>
<span class="line">        mounted() {</span>
<span class="line">            this.newCanvas();</span>
<span class="line">        },</span>
<span class="line">        methods: {</span>
<span class="line">            newCanvas() {</span>
<span class="line">                // 3. è·å–canvasèŠ‚ç‚¹çš„æ–¹å¼å˜äº†ï¼Œå¿…é¡»æŒ‰ç…§è¿™ä¸ªæ ¼å¼å†™</span>
<span class="line">                // 3.1 å¦‚æœä¸æ˜¯ç›´æ¥é¡µé¢è€Œæ˜¯å­é¡µé¢ï¼ŒæŠŠ wx æ”¹æˆ thisï¼Œå¦åˆ™è·å–ä¸åˆ° nodeèŠ‚ç‚¹</span>
<span class="line">                // ä¹Ÿå°±æ˜¯ wx.createSelectorQuery()  å…¶å¥¹éƒ¨åˆ†ä¸€æ ·</span>
<span class="line">                wx.createSelectorQuery()</span>
<span class="line">                    .select('#myCanvas')</span>
<span class="line">                    .node(({</span>
<span class="line">                        node: canvas</span>
<span class="line">                    }) => {</span>
<span class="line">                        //4. è·å–æ­£ç¡®å®ä¾‹</span>
<span class="line">                        const ctx = canvas.getContext('2d');</span>
<span class="line">                     </span>
<span class="line">                        const dpr = wx.getWindowInfo().pixelRatio;</span>
<span class="line">                        console.log("default canvas.width:", canvas.width,</span>
<span class="line">                         " default canvas.height:", canvas.height);</span>
<span class="line">                        console.log("dpr:", dpr);</span>
<span class="line">                        canvas.width = this.styleWidth* dpr;</span>
<span class="line">                        canvas.height = this.styleHeight * dpr;</span>
<span class="line">                        ctx.scale(dpr, dpr);</span>
<span class="line"></span>
<span class="line">                        ctx.fillStyle = "green";</span>
<span class="line">                        ctx.fillRect(0, 0, 50, 50);</span>
<span class="line">                        // 4.1 è®¾ç½®å­—ä½“å¤§å°ï¼ˆä¸¤ä¸ªå‚æ•°å¿…é¡»éƒ½å†™ï¼‰</span>
<span class="line">                        ctx.font = "20px sans-serif";</span>
<span class="line">                        // 4.2 å†™æ–‡å­—</span>
<span class="line">                        ctx.fillText("æˆ‘æ˜¯æ–°ç‰ˆcanvas", 50, 30);</span>
<span class="line"></span>
<span class="line">                        // 4.3 æ–°ç‰ˆ canvas ä¸éœ€è¦è°ƒç”¨ draw()</span>
<span class="line">                        // ctx.draw(); </span>
<span class="line">                    }).exec();</span>
<span class="line">            },</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line">&lt;/script></span>
<span class="line"></span>
<span class="line">&lt;style scoped></span>
<span class="line">    .divider {</span>
<span class="line">        margin: 10px 0;</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    canvas {</span>
<span class="line">        background-color: antiquewhite;</span>
<span class="line">    }</span>
<span class="line">&lt;/style>            </span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://img2024.cnblogs.com/blog/2194212/202502/2194212-20250224155940685-1345758220.png" alt="img"></p>
<h1 id="ä¸‰ã€æ–°ç‰ˆcanvasæ˜“é”™api" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€æ–°ç‰ˆcanvasæ˜“é”™api"><span>ä¸‰ã€æ–°ç‰ˆcanvasæ˜“é”™api</span></a></h1>
<h2 id="idä¸èƒ½ç”¨æ•°å­—å¼€å¤´-å­—ç¬¦ä¸²çš„æ•°å­—ä¹Ÿä¸è¡Œ" tabindex="-1"><a class="header-anchor" href="#idä¸èƒ½ç”¨æ•°å­—å¼€å¤´-å­—ç¬¦ä¸²çš„æ•°å­—ä¹Ÿä¸è¡Œ"><span>idä¸èƒ½ç”¨æ•°å­—å¼€å¤´ï¼Œå­—ç¬¦ä¸²çš„æ•°å­—ä¹Ÿä¸è¡Œ</span></a></h2>
<h2 id="æ‹¬å·èµ‹å€¼å˜æˆäº†ç­‰å·èµ‹å€¼" tabindex="-1"><a class="header-anchor" href="#æ‹¬å·èµ‹å€¼å˜æˆäº†ç­‰å·èµ‹å€¼"><span>æ‹¬å·èµ‹å€¼å˜æˆäº†ç­‰å·èµ‹å€¼</span></a></h2>
<p>æ—§ç‰ˆï¼š ctx.setFillStyle(&quot;red&quot;); ctx.fillRect(50, 50, 75, 75);</p>
<p>æ–°ç‰ˆï¼š // è®¾ç½®çš„æ–¹å¼ä» ctx.setFillStyle(&quot;red&quot;) æ”¹æˆäº† ctx.fillStyle = &quot;red&quot;; ctx.fillStyle = &quot;red&quot;; ctx.fillRect(50, 50, 75, 75);</p>
<h2 id="ç”»å›¾ç‰‡" tabindex="-1"><a class="header-anchor" href="#ç”»å›¾ç‰‡"><span>ç”»å›¾ç‰‡</span></a></h2>
<p>æ—§ç‰ˆï¼š ctx.drawImage(&quot;/static/cherry.png, 0,0,100,100&quot;);</p>
<p>æ–°ç‰ˆï¼š</p>
<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre v-pre><code><span class="line">const image = canvas.createImage();</span>
<span class="line">image.src = "/static/cherry.png";</span>
<span class="line">image.onload = () => {</span>
<span class="line">    //ç­‰å¾…å›¾ç‰‡èµ„æºåŠ è½½å®Œæˆæ‰å¯ä»¥ç”»</span>
<span class="line">    ctx.drawImage(image, 0, 0,100,100);</span>
<span class="line">}</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://img2024.cnblogs.com/blog/2194212/202502/2194212-20250224165102142-387271707.png" alt="img"></p>
<h2 id="è®¾ç½®æ–‡å­—å¤§å°" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®æ–‡å­—å¤§å°"><span>è®¾ç½®æ–‡å­—å¤§å°</span></a></h2>
<p>æ—§ç‰ˆï¼š ctx.setFontSize(20); ctx.fillText('20', 20, 20);</p>
<p>æ–°ç‰ˆï¼š ctx.font = &quot;20px sans-serif&quot;; ctx.fillText(&quot;æˆ‘æ˜¯æ–°ç‰ˆcanvas&quot;, 50, 30);</p>
<h2 id="å®æ—¶åˆ·æ–°æŠ–åŠ¨ç™½å±" tabindex="-1"><a class="header-anchor" href="#å®æ—¶åˆ·æ–°æŠ–åŠ¨ç™½å±"><span>å®æ—¶åˆ·æ–°æŠ–åŠ¨ç™½å±</span></a></h2>
<p>è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œå¦‚æœéœ€è¦å®æ—¶æ›´æ–°æ•°æ®ï¼Œå°±éœ€è¦canvasä¸åŒç»˜ç”»ï¼Œä½†ä¸è¦å¤šæ¬¡è¿è¡Œ const ctx = canvas.getContext('2d'); å¦åˆ™é¡µé¢åˆ·æ–°æ—¶ä¼šæœ‰ç™½å±æŠ–åŠ¨ã€‚</p>
<p>æ­£ç¡®çš„åšæ³•æ˜¯åˆ†ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªåˆå§‹åŒ–contextï¼Œä¸€ä¸ªåªä¸“å¿ƒç”»å†…å®¹ã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘çš„ä¸€éƒ¨åˆ†ä»£ç ï¼ˆä¸èƒ½ç›´æ¥è¿è¡Œï¼Œåˆ å»äº†éƒ¨åˆ†æ•æ„Ÿä¿¡æ¯ï¼‰</p>
<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre v-pre><code><span class="line">&lt;template></span>
<span class="line">    &lt;view></span>
<span class="line">        &lt;view v-for="item in tankList"></span>
<span class="line">            &lt;canvas type="2d" :id="item.id" class="canvas" >&lt;/canvas></span>
<span class="line">        &lt;/view></span>
<span class="line">    &lt;/view></span>
<span class="line">&lt;/template></span>
<span class="line"></span>
<span class="line">&lt;script></span>
<span class="line"></span>
<span class="line">export default {</span>
<span class="line">    props: {</span>
<span class="line">        tankList: {</span>
<span class="line">            type: Array,</span>
<span class="line">            default: []</span>
<span class="line">        }</span>
<span class="line">    },</span>
<span class="line">    data() {</span>
<span class="line">        return {</span>
<span class="line">            // æ²¹ç½å›¾ç‰‡çš„å®½é«˜</span>
<span class="line">            bgimgWidth: 200,</span>
<span class="line">            bgimgHeight: 150,</span>
<span class="line"></span>
<span class="line">            context: [],</span>
<span class="line">            bgImg: null</span>
<span class="line">        }</span>
<span class="line">    },</span>
<span class="line">    mounted() {</span>
<span class="line">        this.createContexts(this.bgimgWidth, this.bgimgHeight);//æ¯æ¬¡è¿›æ¥çš„æ—¶å€™å…ˆç”»ä¸€æ¬¡</span>
<span class="line">    },</span>
<span class="line">    watch: {</span>
<span class="line">        tankList(newValue, oldValue) {</span>
<span class="line">            // if é˜²æ­¢æ²¡æœ‰contextè¿˜è¦ç”»å›¾æŠ¥é”™</span>
<span class="line">            if (this.context.length != 0) {</span>
<span class="line">                this.refreshCanvas(this.bgimgWidth, this.bgimgHeight);</span>
<span class="line">            }</span>
<span class="line">        }</span>
<span class="line">    },</span>
<span class="line">    methods: {</span>
<span class="line">        // è¿™ä¸ªé¡µé¢åªè¿è¡Œä¸€æ¬¡</span>
<span class="line">        createContexts() {</span>
<span class="line">            // â—â—â— æ–°ç‰ˆcanvaséœ€è¦æ¶ˆé™¤é”¯é½¿</span>
<span class="line">            const windowInfo = wx.getWindowInfo();</span>
<span class="line">            const availableWidth = windowInfo.windowWidth;</span>
<span class="line">            const dpr = windowInfo.pixelRatio;//è®¾å¤‡åƒç´ æ¯”</span>
<span class="line"></span>
<span class="line">            // 1. ç»™ context[] èµ‹å€¼ï¼ˆåœ¨è¿™ä¸ªé¡µé¢åªåˆ›å»ºä¸€æ¬¡ï¼‰</span>
<span class="line">            this.tankList.forEach((tank, index) => {</span>
<span class="line">                this.createSelectorQuery()</span>
<span class="line">                    .select(`#${tank.id}`)</span>
<span class="line">                    .node(({ node: canvas }) => {</span>
<span class="line">                        this.context[index] = canvas.getContext('2d');</span>
<span class="line">                        console.log('this.context[] å»ºç«‹æˆåŠŸ');</span>
<span class="line"></span>
<span class="line">                        canvas.width = availableWidth * dpr;</span>
<span class="line">                        canvas.height = availableWidth * 0.4 * dpr; //æŒ‰ç…§ä¸‹é¢cssçš„å°ºå¯¸æ¯”ä¾‹</span>
<span class="line">                        this.context[index].scale(dpr, dpr); //å¿…é¡»æœ‰</span>
<span class="line"></span>
<span class="line">                        //è¿™é‡Œè°ƒç”¨ä¸€éï¼Œé˜²æ­¢ç­‰å¾…æ—¶é—´è¿‡é•¿</span>
<span class="line">                        this.refreshCanvas(this.bgimgWidth, this.bgimgHeight);</span>
<span class="line">                    }).exec();</span>
<span class="line">            })</span>
<span class="line">        },</span>
<span class="line">        refreshCanvas(bgimgWidth, bgimgHeight) {</span>
<span class="line">            const context = this.context;</span>
<span class="line"></span>
<span class="line">            // 2. è®¾ç½®ä¸åŒæ²¹ç½æ²¹å“çš„é¢œè‰²</span>
<span class="line">            let oilColors = [];//å­˜å‚¨ä¸åŒæ²¹ç½æ²¹å“çš„é¢œè‰²</span>
<span class="line">            this.tankList.forEach(tank => {</span>
<span class="line">                oilColors.push(converIntToRgb(tank.oilColor));</span>
<span class="line">            });</span>
<span class="line"></span>
<span class="line">            this.tankList.forEach((tank, index) => {</span>
<span class="line">                this.createSelectorQuery()</span>
<span class="line">                    .select(`#hc${tank.id}`)</span>
<span class="line">                    .node(({ node: canvas }) => {</span>
<span class="line">                        this.bgImg = canvas.createImage();</span>
<span class="line">                        this.bgImg.src = "/static/hcbgimg.png";</span>
<span class="line">                        this.bgImg.onload = () => {</span>
<span class="line">                            // â—â—â— æ¯æ¬¡ç”»æ–°çš„ä¹‹å‰å…ˆæ¸…ç©ºç”»å¸ƒï¼ˆåŒ…æ‹¬å›¾ç‰‡ï¼‰</span>
<span class="line">                            this.context[index].clearRect(0, 0, bgimgWidth, bgimgHeight);</span>
<span class="line"> </span>
<span class="line">                            // æ–°ç‰ˆcanvasç”»èƒŒæ™¯å›¾ç‰‡,å°†å›¾ç‰‡ç»˜åˆ¶åˆ° canvas ä¸Š</span>
<span class="line">                            this.context[index].drawImage(this.bgImg, 0, 0, bgimgWidth, bgimgHeight);</span>
<span class="line"></span>
<span class="line">                            // å†™è¯¦ç»†ä¿¡æ¯(æ”¾å¤–é¢ä¼šè¢«å›¾ç‰‡æŒ¡ä½ï¼Œå› ä¸ºå›¾ç‰‡åŠ è½½è¾ƒæ…¢)</span>
<span class="line">                            const textColor = tank.connect ? "black" : "red";</span>
<span class="line">                            context[index].fillStyle = textColor;</span>
<span class="line">                            context[index].font = "20px sans-serif";</span>
<span class="line">                            context[index].fillText(tank.id, bgimgWidth * 0.06, bgimgHeight * 0.6);</span>
<span class="line">                        }</span>
<span class="line">                    }).exec();</span>
<span class="line">            });</span>
<span class="line">        },</span>
<span class="line">         </span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line">&lt;/script></span>
<span class="line"></span>
<span class="line">&lt;style scoped></span>
<span class="line">.canvas {</span>
<span class="line">    width: 750rpx;</span>
<span class="line">    height: 300rpx;</span>
<span class="line">    margin-top: 30rpx;</span>
<span class="line">    margin-left: 37rpx;</span>
<span class="line">    margin-right: 37rpx;</span>
<span class="line">}</span>
<span class="line">&lt;/style></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></template>


