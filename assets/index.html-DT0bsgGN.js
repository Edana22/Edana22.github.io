import{_ as i,c as a,d as n,o as e}from"./app-DoO5dwbX.js";const p="/assets/uniapp-1-DJbwYo0k.png",t="/assets/uniapp-2-3cdsR6MW.png",h="/assets/uniapp-3-D0rOhZa2.png",l="/assets/uniapp-4-CXWqcY0x.png",k="/assets/uniapp-5-CMEy43S4.gif",r={};function d(g,s){return e(),a("div",null,s[0]||(s[0]=[n('<p>用 uni-app 开发微信小程序时，有一个需求是：</p><div class="hint-container note"><p class="hint-container-title">分享罐表详情页面给其它用户，其它用户（在已经登录的状态下）点击分享卡片可以直接跳转到该罐表详情页，且能显示自己是否已经收藏该罐表（收藏状态由用户 uid 和罐表 id 共同确定）</p></div><h2 id="实现分享功能" tabindex="-1"><a class="header-anchor" href="#实现分享功能"><span>实现分享功能</span></a></h2><p>基本思路是用 微信原生的 <mark>onShareAppMessage</mark> 实现。</p><p>因为开发框架用的是 uni-app，所以微信原生文档和 uni-app 的文档都要看。</p><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>uni-app 文档：<a href="https://uniapp.dcloud.net.cn/api/plugins/share?id=onshareappmessage" target="_blank" rel="noopener noreferrer">onShareAppMessage(OBJECT)</a></p><p>微信小程序文档：<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onShareAppMessage-Object-object" target="_blank" rel="noopener noreferrer">onShareAppMessage(Object object)</a>、<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/scene-list.html" target="_blank" rel="noopener noreferrer">场景值列表</a></p></div><p>path 是其它用户点击分享卡片直接进入的页面，不写默认是分享的当前页面。</p><p><img src="'+p+'" alt="alt text"></p><p>在 <mark>onShareAppMessage</mark> 的 <code>path</code> 中传递的参数，由下一页面的 <code>onLoad（option）</code>接收。</p><p><img src="'+t+'" alt="alt text"></p><p>以上是微信小程序实现页面分享的基础功能。</p><h2 id="遇到-bug" tabindex="-1"><a class="header-anchor" href="#遇到-bug"><span>遇到 bug</span></a></h2><p>但是实现分享功能后，我遇到的一个 bug ：</p><div class="hint-container caution"><p class="hint-container-title">其它用户点分享卡片第一次进入小程序后不能正确获取 uid，第二次进入小程序才能正确获取 uid。</p></div><p>第一次进入小程序：</p><p><img src="'+h+'" alt="alt text"></p><p>第二次进入小程序：</p><p><img src="'+l+'" alt="alt text"></p><h2 id="解决-bug" tabindex="-1"><a class="header-anchor" href="#解决-bug"><span>解决 bug</span></a></h2><p>我参考了丹尼斯小程序，发现可以 <mark>先跳转到 home 页面，然后再自动跳转到详情页</mark>。</p><p>于是我设置了：</p><div class="hint-container tip"><p class="hint-container-title">罐表详情页面的分享设置 path 为 home（而不是当前页面），然后从 home 跳转到罐表详情，这样就可以正确显示页面数据了。</p></div><p>丹尼斯小程序效果如下：</p><p><img src="'+k+`" alt="alt text"></p><h2 id="示例代码" tabindex="-1"><a class="header-anchor" href="#示例代码"><span>示例代码</span></a></h2><p>【罐表详情.vue】</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-javascript"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">onShareAppMessage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">options</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    var</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> msg</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">我给你分享了一个罐表，快来点击查看吧</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    return</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">        title</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> msg</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> // 转发后 所显示的title</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">        path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/pages/home/home?id=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> +</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> this</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">id</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">},</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【home.vue】</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-javascript"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">onLoad</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">option</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    var</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> scene</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> wx</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getLaunchOptionsSync</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">().</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">scene</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> //获取场景值，判断是用哪种方式进入的小程序</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">scene</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> ==</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1007</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> ||</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> scene</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> ==</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1008</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> ||</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> scene</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> ==</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1044</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> //从分享进入</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">option</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">            uni</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">navigateTo</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">({</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">                url</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../subpage/tableMarket/marketSeeTable/marketSeeTable?id=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> +</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> option</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">id</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">            })</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,29)]))}const o=i(r,[["render",d]]),y=JSON.parse('{"path":"/uniapp/qxp0yspz/","title":"微信小程序从分享卡片进入第一次获取不到uid","lang":"zh-CN","frontmatter":{"title":"微信小程序从分享卡片进入第一次获取不到uid","createTime":"2025/07/04 16:15:20","permalink":"/uniapp/qxp0yspz/"},"readingTime":{"minutes":1.88,"words":563},"git":{"createdTime":1751621436000,"updatedTime":1751866430000,"contributors":[{"name":"twoflowers","username":"","email":"1292548615@qq.com","commits":2,"avatar":"https://gravatar.com/avatar/51a398cd538d08b052e061e4b9f2c3353a7fae1d5406ef128cad6096d91bd325?d=retro"}]},"filePathRelative":"notes/uniapp/2.uniapp_debug/1.微信小程序从分享卡片进入，第一次获取不到用户uid、第二次能获取到用户uid.md","headers":[]}');export{o as comp,y as data};
